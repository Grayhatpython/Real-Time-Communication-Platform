# ğŸ§ Real-Time Communication Platform (C++)

ë³¸ í”„ë¡œì íŠ¸ëŠ” C++ë¡œ ì§ì ‘ ì„¤ê³„/êµ¬í˜„í•œ ë„¤íŠ¸ì›Œí¬ ì—”ì§„ì„ ê¸°ë°˜ìœ¼ë¡œ, ì„œë²„-í´ë¼ì´ì–¸íŠ¸ êµ¬ì¡°ì˜ ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ í”Œë«í¼ì„ êµ¬ì¶•í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.
ê²Œì„ ê°œë°œì´ ì•„ë‹ˆë¼ ìƒìš© ì„œë¹„ìŠ¤ ìˆ˜ì¤€ì˜ ë„¤íŠ¸ì›Œí¬/ì„œë²„ ì•„í‚¤í…ì²˜ë¥¼ ì§€í–¥í•˜ë©°, ì¸ì¦/ì„¸ì…˜/ë©”ì‹œì§•/í™•ì¥ì„±/ì„±ëŠ¥ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë‹¨ê³„ì ìœ¼ë¡œ ì™„ì„±ë„ë¥¼ ë†’ì—¬ê°‘ë‹ˆë‹¤.

- ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ëª¨ë‘ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ ì—”ì§„ ì‚¬ìš©
- íŒ¨í‚· ê¸°ë°˜ í”„ë¡œí† ì½œë¡œ í†µì‹  (ê¸¸ì´ + PacketId + Payload)
- í´ë¼ì´ì–¸íŠ¸ UIëŠ” ImGuië¡œ êµ¬ì„±
- ì¸ì¦ ë°ì´í„°ëŠ” SQLiteë¡œ ê´€ë¦¬ (í–¥í›„ DB ì›Œì»¤/í™•ì¥ ê³ ë ¤)

---

## ğŸ¯ í”„ë¡œì íŠ¸ ëª©ì 

- í™•ì¥ ê°€ëŠ¥í•œ í”„ë¡œí† ì½œ/í•¸ë“¤ëŸ¬/ìŠ¤ë ˆë”© ëª¨ë¸ ê¸°ë°˜ í™•ë³´
- recv / send ì‹œì ì„ ì„œë²„ ë¡œì§ì´ ëª…í™•íˆ í†µì œ
- ê³ ë¶€í•˜ í™˜ê²½ì—ì„œë„ ì˜ˆì¸¡ ê°€ëŠ¥í•œ íë¦„ ìœ ì§€
- ì‹¤ì„œë¹„ìŠ¤ì—ì„œ í•„ìš”í•œ ìš”ì†Œ(ì¸ì¦, ì„¸ì…˜, ì ‘ê·¼ ì œì–´, ë¡œê¹…, ì•ˆì •ì„±)ë¥¼ MVPë¶€í„° ì²´ê³„ì ìœ¼ë¡œ ë°˜ì˜

---

## ğŸ§  í•µì‹¬ ê¸°ëŠ¥(í˜„ì¬ ì§„í–‰ ìƒíƒœ)

### 1ï¸âƒ£ ë„¤íŠ¸ì›Œí¬ ì—”ì§„ ê³µí†µí™”
ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì¼í•œ ì—”ì§„ì„ ì‚¬ìš©í•˜ë©°, ë‹¤ìŒì„ ì œê³µ:
- Session ê¸°ë°˜ ì—°ê²° ê´€ë¦¬
- SendBufferArena / SendContext ê¸°ë°˜ ì†¡ì‹  íŒŒì´í”„ë¼ì¸
- BinaryReader / BinaryWriter ê¸°ë°˜ ì§ë ¬í™”/ì—­ì§ë ¬í™”
- íŒ¨í‚· ë‹¨ìœ„ë¡œ ì™„ì„±ëœ ë°ì´í„°ê°€ OnRecv(buffer, size)ë¡œ ì „ë‹¬ë˜ëŠ” êµ¬ì¡°

### 2ï¸âƒ£ í”„ë¡œí† ì½œ êµ¬ì¡°
íŒ¨í‚· í¬ë§·ì„ ë‹¨ìˆœí•˜ê³  ëª…í™•í•˜ê²Œ ê³ ì •
- uint16 size (í—¤ë” í¬í•¨ ì „ì²´ í¬ê¸°)
- uint16 packetId
- payload (ì§ë ¬í™” ë°ì´í„°)
ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ëª¨ë‘ ë™ì¼í•˜ê²Œ íŒŒì‹± ë° ë””ìŠ¤íŒ¨ì¹˜í•©ë‹ˆë‹¤.

### 3ï¸âƒ£ íŒ¨í‚· ë””ìŠ¤íŒ¨ì¹˜(í•¸ë“¤ëŸ¬) êµ¬ì¡°
PacketIdë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒ¨í‚·ì„ ë¼ìš°íŒ…í•˜ëŠ” Dispatcherë¥¼ êµ¬ì„±:
- OnRecvì—ì„œ í—¤ë” ê²€ì¦ í›„ payload BinaryReader ìƒì„±
- Dispatcherê°€ PacketId â†’ Deserialize â†’ packet Handler ìˆœì„œë¡œ ì²˜ë¦¬
- ì˜ëª»ëœ íŒ¨í‚·/ë¯¸ë“±ë¡ PacketIdëŠ” ì •ì±…ì— ë”°ë¼ ì—°ê²° ì¢…ë£Œ ë“± ë°©ì–´ ì²˜ë¦¬

### 4ï¸âƒ£ ì¸ì¦/ì„¸ì…˜(ì´ˆê¸° MVP)
SQLite ê¸°ë°˜ ì¸ì¦ DBë¥¼ êµ¬ì„±í•˜ê³ , ë‹¤ìŒ í”Œë¡œìš°ë¥¼ êµ¬í˜„ ì¤‘:
- Register: ì‚¬ìš©ì ìƒì„±(ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ ì €ì¥)
- Login: ìê²© ì¦ëª… ê²€ì¦ í›„ ì„¸ì…˜ í† í° ë°œê¸‰/ì €ì¥
- Resume: í† í° ê¸°ë°˜ ì¬ì ‘ì†(ìë™ ë¡œê·¸ì¸) ê²€ì¦
í† í°ì€ ì„œë²„(DB)ì— ì €ì¥ë˜ë©°, í´ë¼ì´ì–¸íŠ¸ëŠ” í† í°ì„ ë¡œì»¬ì— ì €ì¥í•´ ì¬ì ‘ì† ì‹œ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

## ì„œë²„(Server) ì•„í‚¤í…ì²˜

ì„œë²„ëŠ” **Accept ì „ìš© ìŠ¤ë ˆë“œ**, **ë©€í‹° Dispatch ìŠ¤ë ˆë“œ(per-thread epoll)**, **DB Worker ë‹¨ì¼ ìŠ¤ë ˆë“œ**ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

### 1) ìŠ¤ë ˆë“œ ëª¨ë¸

#### A. Accept Thread (1ê°œ)
- ë¦¬ìŠ¤ë‹ ì†Œì¼“ì„ ê°ì‹œí•˜ëŠ” **ì „ìš© epoll ì¸ìŠ¤í„´ìŠ¤**ë¥¼ ë³´ìœ í•©ë‹ˆë‹¤.
- ì‹ ê·œ ì—°ê²°ì„ `accept()` ì²˜ë¦¬í•©ë‹ˆë‹¤.
- accept ì„±ê³µ ì‹œ, ì—°ê²° ê²°ê³¼ë¥¼ **Dispatch Thread ê·¸ë£¹ ì¤‘ í•˜ë‚˜ë¡œ ì „ë‹¬**í•©ë‹ˆë‹¤.  

#### B. Dispatch Threads (Nê°œ)
ê° Dispatch ìŠ¤ë ˆë“œëŠ”:
- **ìê¸° ì „ìš© epoll ì¸ìŠ¤í„´ìŠ¤**ë¥¼ ë³´ìœ í•©ë‹ˆë‹¤.
- ìì‹ ì—ê²Œ í• ë‹¹ëœ **ì—¬ëŸ¬ ê°œì˜ Session**ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
- í•´ë‹¹ Sessionë“¤ì— ëŒ€í•´ ë„¤íŠ¸ì›Œí¬ I/O íŒŒì´í”„ë¼ì¸ì„ ì „ë‹´í•©ë‹ˆë‹¤.
  - `epoll_wait`
  - recv ì´ë²¤íŠ¸ ì²˜ë¦¬
  - send flush(í ê¸°ë°˜)
  - ì„¸ì…˜ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬(ìƒì„±/ì¢…ë£Œ/íƒ€ì„ì•„ì›ƒ ë“±)

> **ì„¤ê³„ ì˜ë„:** ë„¤íŠ¸ì›Œí¬ I/O ê´€ì ì—ì„œ Sessionì€ íŠ¹ì • Dispatch ìŠ¤ë ˆë“œê°€ ì‚¬ì‹¤ìƒ *ë‹¨ë… ì†Œìœ *í•˜ë„ë¡ êµ¬ì„±í•˜ì—¬, ë½ ê²½í•©ì„ ì¤„ì´ê³  ì±…ì„ ê²½ê³„ë¥¼ ëª…í™•íˆ í•©ë‹ˆë‹¤.

#### C. DB Worker Thread (1ê°œ)
- DB ì ‘ê·¼ì„ **ë‹¨ì¼ ìŠ¤ë ˆë“œì—ì„œ ì§ë ¬í™”**í•©ë‹ˆë‹¤(íŠ¹íˆ SQLiteì— ì í•©).
- í˜„ì¬ëŠ” **Auth(ê°€ì…/ë¡œê·¸ì¸/í† í° ê²€ì¦)** ì—…ë¬´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- í–¥í›„ ë©”ì‹œì§€ ì €ì¥/ê²€ìƒ‰, ê¶Œí•œ/ì—­í• , ê°ì‚¬ ë¡œê·¸ ë“±ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°ë¥¼ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.
- Dispatch ìŠ¤ë ˆë“œê°€ DB Workerì— ì‘ì—…ì„ íì‰í•˜ê³ , ê²°ê³¼ë¥¼ ë°›ì•„ ì‘ë‹µì„ ì „ì†¡í•˜ëŠ” í˜•íƒœì…ë‹ˆë‹¤.

---

### 2) ì—°ê²° ë¼ì´í”„ì‚¬ì´í´(ì„œë²„)

1. **Accept Thread**ê°€ ì‹ ê·œ ì—°ê²°ì„ accept
2. accept ê²°ê³¼ë¥¼ íŠ¹ì • **Dispatch Thread**ë¡œ ì „ë‹¬(handoff)
3. í•´ë‹¹ Dispatch Threadê°€:
   - Session ê°ì²´ ìƒì„±
   - ìì‹ ì˜ epollì— ë“±ë¡
   - ì´í›„ ë„¤íŠ¸ì›Œí¬ ì´ë²¤íŠ¸ë¥¼ ì „ë‹´ ì²˜ë¦¬
4. íŒ¨í‚·ì´ ì™„ì„±ë˜ë©´ `OnRecv(buffer, size)` í˜¸ì¶œ â†’ íŒŒì‹±/ë””ìŠ¤íŒ¨ì¹˜ â†’ í•¸ë“¤ëŸ¬ ì‹¤í–‰
5. DB ì²˜ë¦¬ê°€ í•„ìš”í•˜ë©´ Dispatch â†’ DB Workerë¡œ job enqueue
6. DB Worker ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Dispatch/Sessionì—ì„œ ì‘ë‹µ ì „ì†¡

---

### 3) íŒ¨í‚· ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸(ì„œë²„)

- íŒ¨í‚· í¬ë§·(í”„ë ˆì´ë°)ì€ ë‹¤ìŒê³¼ ê°™ì´ ê³ ì •í•©ë‹ˆë‹¤.

  `uint16 size(í—¤ë” í¬í•¨ ì „ì²´ ê¸¸ì´) + uint16 packetId + payload`

- ë„¤íŠ¸ì›Œí¬ ë ˆì´ì–´ì—ì„œ **íŒ¨í‚· ê²½ê³„ê°€ ë³µì›ëœ ìƒíƒœ**ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´ì— ì „ë‹¬ë©ë‹ˆë‹¤.

  `OnRecv(BYTE* buffer, int32 numOfBytes)`  â† bufferëŠ” íŒ¨í‚· ì‹œì‘ ì£¼ì†Œ, numOfBytesëŠ” í—¤ë” í¬í•¨ ì „ì²´ ê¸¸ì´

- ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´ëŠ”:
  1. í—¤ë” ê²€ì¦(ê¸¸ì´/ID sanity check)
  2. payload ë²”ìœ„ë¡œ `BinaryReader` ìƒì„±
  3. `PacketDispatcher`ë¡œ ë¼ìš°íŒ…: `PacketId â†’ Deserialize â†’ Packet Handler`

---

## í´ë¼ì´ì–¸íŠ¸(Client) ì•„í‚¤í…ì²˜

í´ë¼ì´ì–¸íŠ¸ëŠ” **ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬**ì™€ **UI ë Œë”ë§**ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤.

### 1) ìŠ¤ë ˆë“œ ëª¨ë¸

#### A. Dispatch Thread (1ê°œ)
- ë‹¨ì¼ `epoll` ì¸ìŠ¤í„´ìŠ¤ë¡œ ì„œë²„ ì—°ê²° ì„¸ì…˜ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
- ë„¤íŠ¸ì›Œí¬ ì†¡ìˆ˜ì‹  ë° íŒ¨í‚· ë””ìŠ¤íŒ¨ì¹˜ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- ì„œë²„ì™€ ë™ì¼í•œ í”„ë¡œí† ì½œ í”„ë ˆì´ë°/ì§ë ¬í™” ê·œê²©ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### B. UI Thread (Main / ImGui)
- ImGui ë Œë”ë§ ë° ì…ë ¥ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.
- ë„¤íŠ¸ì›Œí¬ ìŠ¤ë ˆë“œì™€ UI ìŠ¤ë ˆë“œ ê°„ì˜ **ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ êµ¬ì¡°ëŠ” í˜„ì¬ ì„¤ê³„/êµ¬í˜„ ì§„í–‰ ì¤‘**ì…ë‹ˆë‹¤.
  - ì—°ê²° ì™„ë£Œ ì´ë²¤íŠ¸ ì „ë‹¬(OnConnected)
  - ì¸ì¦ ê²°ê³¼ ë°˜ì˜(ì„±ê³µ/ì‹¤íŒ¨, í† í° ì €ì¥/ë¡œë“œ)
  - ë¡œê·¸/ìƒíƒœ í‘œì‹œ
  - (í–¥í›„) ë©”ì‹œì§€ ìˆ˜ì‹ /í‘œì‹œ ë° ì‚¬ìš©ì ì…ë ¥ ì „ì†¡

> ëª©í‘œëŠ” í–¥í›„ ë©”ì‹œì§€/ì´ë²¤íŠ¸ í­ì£¼ ìƒí™©ì—ì„œë„ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” **ìŠ¤ë ˆë“œ ì•ˆì „ ì´ë²¤íŠ¸/ì»¤ë§¨ë“œ ì „ë‹¬ ë©”ì»¤ë‹ˆì¦˜**ì„ í™•ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

---

#### ğŸ”¹ í˜„ì¬ êµ¬í˜„ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ v ]SQLite DB ìƒì„± ë° ìŠ¤í‚¤ë§ˆ ì ìš©(users/sessions)
- [ v ]íŒ¨í‚· í¬ë§· ê³ ì •(ê¸¸ì´ + PacketId)
- [ v ]OnRecv ê¸°ë°˜ íŒ¨í‚· íŒŒì‹±/ê²€ì¦
- [ v ]PacketDispatcher ê¸°ë°˜ í•¸ë“¤ëŸ¬ ë“±ë¡/í˜¸ì¶œ êµ¬ì¡°
- [ v ]Auth íŒ¨í‚·(Register/Login/Resume) ì •ì˜ ë° ì§ë ¬í™”
- [   ]ImGui í´ë¼ì´ì–¸íŠ¸ì—ì„œ Dispatch thread + ImGui UI thread ë™ê¸°í™” êµ¬ì¡° ì§„í–‰ ë° ì¸ì¦ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ UI êµ¬ì¶•(ì—°ê²°/ë¡œê·¸/í† í° ê´€ë¦¬)

---

#### ğŸ”¹ í–¥í›„ ë¡œë“œë§µ(í…ìŠ¤íŠ¸ ê¸°ëŠ¥ í™•ì¥)
MVP ì¸ì¦ ì´í›„ ë‹¨ê³„ì ìœ¼ë¡œ ë‹¤ìŒì„ í™•ì¥í•  ì˜ˆì •:
- ì±„ë„/ë£¸ Join
- ì±„ë„ ì •ë³´/ë©¤ë²„ ê´€ë¦¬
- ë©”ì‹œì§€ ì „ì†¡/ë¸Œë¡œë“œìºìŠ¤íŠ¸
- ì„œë²„ì—ì„œ ì±„ë„ ë‹¨ìœ„ fan-out
- ê¶Œí•œ/ì—­í• /ì ‘ê·¼ ì œì–´
- Presence(ì˜¨ë¼ì¸ ìƒíƒœ)
- ë¡œê·¸/ëª¨ë‹ˆí„°ë§/ë©”íŠ¸ë¦­

---

#### ğŸ“ ë¹„ê³  (ìš´ì˜/í™•ì¥ í¬ì¸íŠ¸)

- Language: C++
- UI: ImGui
- DB: SQLite
- Build: CMake
- CodeEditor: VSCode
- OS: Ubuntu (ê°œë°œ/ì„œë²„ í™˜ê²½)

---

âœ¨ Build (Ubuntu)

```bash
sudo apt update
sudo apt install -y build-essential cmake ninja-build gdb

### Optional: Client Dependencies ( Opengl - Imgui )

```bash

sudo apt install -y libgl1-mesa-dev
sudo apt install -y libx11-dev libxrandr-dev libxi-dev libxinerama-dev libxcursor-dev

cmake -S . -B build -G Ninja -DCMAKE_BUILD_TYPE=Debug
cmake --build build


./build/apps/server/server
./build/apps/client/client
